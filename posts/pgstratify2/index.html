<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>pgstratify, Part 2 &middot; Rows and Columns</title>

    <meta name="description" content="">

    <meta name="generator" content="Hugo 0.78.2" />
    <meta name="twitter:card" content="summary">
    
    <meta name="twitter:title" content="pgstratify, Part 2 &middot; Rows and Columns">
    <meta name="twitter:description" content="">

    <meta property="og:type" content="article">
    <meta property="og:title" content="pgstratify, Part 2 &middot; Rows and Columns">
    <meta property="og:description" content="">

    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700|Oxygen:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">

    <link rel="stylesheet" href='https://jlucasdba.github.io/css/all.min.css'>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="alternate" type="application/rss+xml" title="Rows and Columns" href='https://jlucasdba.github.io/index.xml' />
</head>
<body>


<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
    <div class="header">
        <hgroup>
            <h1 class="brand-title"><a href="https://jlucasdba.github.io/">Rows and Columns</a></h1>
            <h2 class="brand-tagline"> Journal of a Database Admin </h2>
            <h2><a href="/about">About Me</a></h2>
        </hgroup>

        <nav class="nav">
            <ul class="nav-list">
                
                
                
                
                <li class="nav-item">
                    <a class="pure-button" href='https://jlucasdba.github.io/index.xml'>
                        <i class="fa fa-rss"></i> rss
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</div>


    <div class="content pure-u-1 pure-u-md-3-4">
        <div>
            
            <div class="posts">
                <h1 class="content-subhead">05 Jan 2022, 17:53</h1>
                <section class="post">
                    <header class="post-header">

                        <a href="https://jlucasdba.github.io/posts/pgstratify2/" class="post-title">pgstratify, Part 2</a>

                        <p class="post-meta">
                            
                            
                        </p>
                    </header>
                    
                    <div class="post-description">
                        <p>In my last post I talked about my new tool, pgstratify. I started writing this post to go over pgstratify use-cases, but it ended up being all about the details of autovacuuming instead. The use-cases will have to wait for Part 3. Note that I&rsquo;m turning autovacuum on and off here for illustration purposes. Obviously don&rsquo;t do this in a production database.</p>
<p>So to start with, we create a small test table and insert some rows into it:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgres" data-lang="postgres"><span style="color:#00a8c8">create</span> <span style="color:#00a8c8">table</span> <span style="color:#111">vactest</span><span style="color:#111">(</span><span style="color:#111">id</span> <span style="color:#111">integer</span><span style="color:#111">,</span> <span style="color:#111">t</span> <span style="color:#111">text</span><span style="color:#111">);</span>
<span style="color:#00a8c8">CREATE</span> <span style="color:#00a8c8">TABLE</span>
<span style="color:#00a8c8">insert</span> <span style="color:#00a8c8">into</span> <span style="color:#111">vactest</span> <span style="color:#111">(</span><span style="color:#111">id</span><span style="color:#111">,</span> <span style="color:#111">t</span><span style="color:#111">)</span> <span style="color:#00a8c8">select</span> <span style="color:#111">generate_series</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">10000</span><span style="color:#111">),</span><span style="color:#d88200">&#39;foo&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">INSERT</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">10000</span>
</code></pre></div><p>Now we have a table with 10000 rows. Let&rsquo;s look at what postgres knows about it:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgres" data-lang="postgres"><span style="color:#00a8c8">select</span> <span style="color:#111">relname</span><span style="color:#111">,</span> <span style="color:#111">n_dead_tup</span><span style="color:#111">,</span> <span style="color:#111">n_mod_since_analyze</span> <span style="color:#00a8c8">from</span> <span style="color:#111">pg_stat_all_tables</span> <span style="color:#00a8c8">where</span> <span style="color:#111">relname</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;vactest&#39;</span><span style="color:#111">;</span>
 <span style="color:#111">relname</span> <span style="color:#f92672">|</span> <span style="color:#111">n_dead_tup</span> <span style="color:#f92672">|</span> <span style="color:#111">n_mod_since_analyze</span> 
<span style="color:#75715e">---------+------------+--------------------
</span><span style="color:#75715e"></span> <span style="color:#111">vactest</span> <span style="color:#f92672">|</span>          <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span>               <span style="color:#ae81ff">10000</span>

<span style="color:#00a8c8">select</span> <span style="color:#111">relname</span><span style="color:#111">,</span> <span style="color:#111">reltuples</span> <span style="color:#00a8c8">from</span> <span style="color:#111">pg_class</span> <span style="color:#00a8c8">where</span> <span style="color:#111">relname</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;vactest&#39;</span><span style="color:#111">;</span>
 <span style="color:#111">relname</span> <span style="color:#f92672">|</span> <span style="color:#111">reltuples</span> 
<span style="color:#75715e">---------+-----------
</span><span style="color:#75715e"></span> <span style="color:#111">vactest</span> <span style="color:#f92672">|</span>         <span style="color:#ae81ff">0</span>
</code></pre></div><p>These are the values autovacuum looks at to determine what needs to be done for a table. (Actually in newer postgres releases, it also looks at rows inserted, but I&rsquo;m going to leave that aside for now.) <code>n_dead_tup</code> is the number of updated/deleted tuples in the table that have not yet been vacuumed. <code>n_mod_since_analyze</code> is the tuples updated/deleted/inserted since the last analyze. Autovacuum can decide to VACUUM, ANALYZE, or VACUUM ANALYZE based on these stats. <code>reltuples</code>, from <code>pg_class</code> is 0 because the table hasn&rsquo;t been analyzed yet. Normally autovacuum will run analyze and keep this reasonably up to date.</p>
<p>So autovacuum has two parameters for vacuum (<code>autovacuum_vacuum_threshold</code>, <code>autovacuum_vacuum_scale_factor</code>) and two for analyze (<code>autovacuum_analyze_threshold</code>, <code>autovacuum_analyze_scale_factor</code>). It evaluates a vacuum is needed if <code>n_dead_tup &gt; (autovacuum_vacuum_threshold + (autovacuum_vacuum_scale_factor * reltuples))</code>, and an analyze is needed if <code>n_mod_since_analyze &gt; (autovacuum_analyze_threshold + (autovacuum_analyze_scale_factor * reltuples))</code>. The defaults for both threshold parameters are 50. The default for vacuum scale factor is .2 and the default for analyze scale factor is .1. So here <code>n_dead_tup</code> is 0 so it won&rsquo;t vacuum, but <code>n_mod_since_analyze</code> is 10000 so it will analyze.</p>
<p>After turning autovacuum back on temporarily we see this in the log:</p>
<pre><code>LOG:  automatic analyze of table &quot;stratify.public.vactest&quot; system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.01 s
</code></pre><p>And if we re-run our previous queries we see the statistics have been updated:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgres" data-lang="postgres"><span style="color:#00a8c8">select</span> <span style="color:#111">relname</span><span style="color:#111">,</span> <span style="color:#111">n_dead_tup</span><span style="color:#111">,</span> <span style="color:#111">n_mod_since_analyze</span> <span style="color:#00a8c8">from</span> <span style="color:#111">pg_stat_all_tables</span> <span style="color:#00a8c8">where</span> <span style="color:#111">relname</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;vactest&#39;</span><span style="color:#111">;</span>
 <span style="color:#111">relname</span> <span style="color:#f92672">|</span> <span style="color:#111">n_dead_tup</span> <span style="color:#f92672">|</span> <span style="color:#111">n_mod_since_analyze</span> 
<span style="color:#75715e">---------+------------+---------------------
</span><span style="color:#75715e"></span> <span style="color:#111">vactest</span> <span style="color:#f92672">|</span>          <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span>                   <span style="color:#ae81ff">0</span>

<span style="color:#00a8c8">select</span> <span style="color:#111">relname</span><span style="color:#111">,</span> <span style="color:#111">reltuples</span> <span style="color:#00a8c8">from</span> <span style="color:#111">pg_class</span> <span style="color:#00a8c8">where</span> <span style="color:#111">relname</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;vactest&#39;</span><span style="color:#111">;</span>
 <span style="color:#111">relname</span> <span style="color:#f92672">|</span> <span style="color:#111">reltuples</span> 
<span style="color:#75715e">---------+-----------
</span><span style="color:#75715e"></span> <span style="color:#111">vactest</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">10000</span>
</code></pre></div><p>So now we have a clean table with no dead tuples. However you still might want to manually vacuum this table at least once. Here&rsquo;s why:</p>
<pre><code>vacuum verbose vactest;
INFO:  vacuuming &quot;public.vactest&quot;
INFO:  &quot;vactest&quot;: found 0 removable, 10000 nonremovable row versions in 45 out of 45 pages

vacuum verbose vactest;
INFO:  vacuuming &quot;public.vactest&quot;
INFO:  &quot;vactest&quot;: found 0 removable, 56 nonremovable row versions in 1 out of 45 pages
</code></pre><p>The first vacuum run scans all 45 pages in the table because they are new and have never previously been vacuumed. The second vacuum run only has to examine 1 page, because the postgres visibility map tracks whether pages have been modified since they were last vacuumed. Postgres can skip known-clean pages for a speedup. For large tables, this optimization is an important factor in keeping your vacuum run times down.</p>
<p>Now we&rsquo;ll create some dead tuples.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgres" data-lang="postgres"><span style="color:#00a8c8">update</span> <span style="color:#111">vactest</span> <span style="color:#00a8c8">set</span> <span style="color:#111">t</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;bar&#39;</span> <span style="color:#00a8c8">where</span> <span style="color:#111">id</span><span style="color:#f92672">%</span><span style="color:#ae81ff">3</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span>
<span style="color:#00a8c8">UPDATE</span> <span style="color:#ae81ff">3333</span>

<span style="color:#00a8c8">select</span> <span style="color:#111">relname</span><span style="color:#111">,</span> <span style="color:#111">n_dead_tup</span><span style="color:#111">,</span> <span style="color:#111">n_mod_since_analyze</span> <span style="color:#00a8c8">from</span> <span style="color:#111">pg_stat_all_tables</span> <span style="color:#00a8c8">where</span> <span style="color:#111">relname</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;vactest&#39;</span><span style="color:#111">;</span>
 <span style="color:#111">relname</span> <span style="color:#f92672">|</span> <span style="color:#111">n_dead_tup</span> <span style="color:#f92672">|</span> <span style="color:#111">n_mod_since_analyze</span> 
<span style="color:#75715e">---------+------------+---------------------
</span><span style="color:#75715e"></span> <span style="color:#111">vactest</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">3333</span> <span style="color:#f92672">|</span>                <span style="color:#ae81ff">3333</span>
</code></pre></div><p>We&rsquo;ve modified over 20% of the rows in the table, so autovacuum will trigger a vacuum run now.</p>
<pre><code>LOG:  automatic vacuum of table &quot;stratify.public.vactest&quot;: index scans: 0
        pages: 0 removed, 59 remain, 0 skipped due to pins, 0 skipped frozen
        tuples: 3333 removed, 10000 remain, 0 are dead but not yet removable, oldest xmin: 3745637
        buffer usage: 144 hits, 0 misses, 1 dirtied
        avg read rate: 0.000 MB/s, avg write rate: 9.753 MB/s
        system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.00 s
</code></pre><p>So the autovacuum output doesn&rsquo;t actually reflect the speedup from skipping known-vacuumed pages, but it does take advantage of it. The other important factor in how long vacuum takes to run is the number of dead tuples that need to be removed. This is especially true when indexes are involved, because the dead tuples have to be stored in memory, and each index on the table has to be scanned to clean up the corresponding index entries.</p>
<p>So now let&rsquo;s setup a more realistic example and try to demonstrate:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgres" data-lang="postgres"><span style="color:#111">stratify</span><span style="color:#f92672">=#</span> <span style="color:#00a8c8">create</span> <span style="color:#00a8c8">table</span> <span style="color:#111">vactest</span><span style="color:#111">(</span><span style="color:#111">id</span> <span style="color:#111">integer</span><span style="color:#111">,</span> <span style="color:#111">t</span> <span style="color:#111">text</span><span style="color:#111">);</span>
<span style="color:#00a8c8">CREATE</span> <span style="color:#00a8c8">TABLE</span>
<span style="color:#111">stratify</span><span style="color:#f92672">=#</span> <span style="color:#00a8c8">insert</span> <span style="color:#00a8c8">into</span> <span style="color:#111">vactest</span> <span style="color:#111">(</span><span style="color:#111">id</span><span style="color:#111">,</span> <span style="color:#111">t</span><span style="color:#111">)</span> <span style="color:#00a8c8">select</span> <span style="color:#111">generate_series</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">50000000</span><span style="color:#111">),</span><span style="color:#d88200">&#39;foo&#39;</span><span style="color:#111">;</span>
<span style="color:#00a8c8">INSERT</span> <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">50000000</span>
<span style="color:#111">stratify</span><span style="color:#f92672">=#</span> <span style="color:#00a8c8">alter</span> <span style="color:#00a8c8">table</span> <span style="color:#111">vactest</span> <span style="color:#00a8c8">add</span> <span style="color:#00a8c8">constraint</span> <span style="color:#111">pk_vactest</span> <span style="color:#00a8c8">primary</span> <span style="color:#00a8c8">key</span> <span style="color:#111">(</span><span style="color:#111">id</span><span style="color:#111">);</span>
<span style="color:#00a8c8">ALTER</span> <span style="color:#00a8c8">TABLE</span>
<span style="color:#111">stratify</span><span style="color:#f92672">=#</span> <span style="color:#00a8c8">create</span> <span style="color:#00a8c8">index</span> <span style="color:#111">idx01_vactest</span> <span style="color:#00a8c8">on</span> <span style="color:#111">vactest</span> <span style="color:#111">(</span><span style="color:#111">t</span><span style="color:#111">);</span>
<span style="color:#00a8c8">CREATE</span> <span style="color:#00a8c8">INDEX</span>
</code></pre></div><p>So now we have a table with 50000000 rows, and a couple of indexes. I&rsquo;ve analyzed and vacuumed the table. I&rsquo;m going to update 20% of the table, which would be the threshold to trigger an autovacuum with scale factor .2:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgres" data-lang="postgres"><span style="color:#00a8c8">update</span> <span style="color:#111">vactest</span> <span style="color:#00a8c8">set</span> <span style="color:#111">t</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;bar&#39;</span> <span style="color:#00a8c8">where</span> <span style="color:#111">id</span><span style="color:#f92672">%</span><span style="color:#ae81ff">5</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span>
<span style="color:#00a8c8">UPDATE</span> <span style="color:#ae81ff">10000000</span>
</code></pre></div><p>I&rsquo;m going to manually vacuum so we can get more detail about what is happening, but I&rsquo;m going to set <code>vacuum_cost_delay=2</code> to throttle my manual vacuum the same way autovacuum is throttled by default. <code>vacuum_cost_limit</code> is still set to <code>200</code>, which is also the default.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgres" data-lang="postgres"><span style="color:#00a8c8">vacuum</span> <span style="color:#00a8c8">verbose</span> <span style="color:#111">vactest</span><span style="color:#111">;</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#111">vacuuming</span> <span style="color:#d88200">&#34;public.vactest&#34;</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#111">scanned</span> <span style="color:#00a8c8">index</span> <span style="color:#d88200">&#34;pk_vactest&#34;</span> <span style="color:#00a8c8">to</span> <span style="color:#111">remove</span> <span style="color:#ae81ff">10000000</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">5.37</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.99</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">132.77</span> <span style="color:#111">s</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#111">scanned</span> <span style="color:#00a8c8">index</span> <span style="color:#d88200">&#34;idx01_vactest&#34;</span> <span style="color:#00a8c8">to</span> <span style="color:#111">remove</span> <span style="color:#ae81ff">10000000</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">5.58</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">1.19</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">135.31</span> <span style="color:#111">s</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#d88200">&#34;vactest&#34;</span><span style="color:#111">:</span> <span style="color:#111">removed</span> <span style="color:#ae81ff">10000000</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">221239</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">1.95</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">1.34</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">172.68</span> <span style="color:#111">s</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#00a8c8">index</span> <span style="color:#d88200">&#34;pk_vactest&#34;</span> <span style="color:#111">now</span> <span style="color:#111">contains</span> <span style="color:#ae81ff">50000000</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">274193</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#ae81ff">10000000</span> <span style="color:#00a8c8">index</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#111">were</span> <span style="color:#111">removed</span><span style="color:#ae81ff">.</span>
<span style="color:#ae81ff">0</span> <span style="color:#00a8c8">index</span> <span style="color:#111">pages</span> <span style="color:#111">have</span> <span style="color:#111">been</span> <span style="color:#111">deleted</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">are</span> <span style="color:#111">currently</span> <span style="color:#111">reusable</span><span style="color:#ae81ff">.</span>
<span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#ae81ff">.</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#00a8c8">index</span> <span style="color:#d88200">&#34;idx01_vactest&#34;</span> <span style="color:#111">now</span> <span style="color:#111">contains</span> <span style="color:#ae81ff">50000000</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">163110</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#ae81ff">10000000</span> <span style="color:#00a8c8">index</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#111">were</span> <span style="color:#111">removed</span><span style="color:#ae81ff">.</span>
<span style="color:#ae81ff">0</span> <span style="color:#00a8c8">index</span> <span style="color:#111">pages</span> <span style="color:#111">have</span> <span style="color:#111">been</span> <span style="color:#111">deleted</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">are</span> <span style="color:#111">currently</span> <span style="color:#111">reusable</span><span style="color:#ae81ff">.</span>
<span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#ae81ff">.</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#d88200">&#34;vactest&#34;</span><span style="color:#111">:</span> <span style="color:#111">found</span> <span style="color:#ae81ff">10000000</span> <span style="color:#111">removable</span><span style="color:#111">,</span> <span style="color:#ae81ff">50000000</span> <span style="color:#111">nonremovable</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">265487</span> <span style="color:#00a8c8">out</span> <span style="color:#00a8c8">of</span> <span style="color:#ae81ff">265487</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#ae81ff">0</span> <span style="color:#111">dead</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#111">cannot</span> <span style="color:#111">be</span> <span style="color:#111">removed</span> <span style="color:#111">yet</span><span style="color:#111">,</span> <span style="color:#111">oldest</span> <span style="color:#111">xmin</span><span style="color:#111">:</span> <span style="color:#ae81ff">3745654</span>
<span style="color:#111">There</span> <span style="color:#111">were</span> <span style="color:#ae81ff">0</span> <span style="color:#111">unused</span> <span style="color:#111">item</span> <span style="color:#111">identifiers</span><span style="color:#ae81ff">.</span>
<span style="color:#111">Skipped</span> <span style="color:#ae81ff">0</span> <span style="color:#111">pages</span> <span style="color:#111">due</span> <span style="color:#00a8c8">to</span> <span style="color:#111">buffer</span> <span style="color:#111">pins</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">frozen</span> <span style="color:#111">pages</span><span style="color:#ae81ff">.</span>
<span style="color:#ae81ff">0</span> <span style="color:#111">pages</span> <span style="color:#111">are</span> <span style="color:#111">entirely</span> <span style="color:#111">empty</span><span style="color:#ae81ff">.</span>
<span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">16.75</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">5.33</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">607.10</span> <span style="color:#111">s</span><span style="color:#ae81ff">.</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#111">vacuuming</span> <span style="color:#d88200">&#34;pg_toast.pg_toast_94097&#34;</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#00a8c8">index</span> <span style="color:#d88200">&#34;pg_toast_94097_index&#34;</span> <span style="color:#111">now</span> <span style="color:#111">contains</span> <span style="color:#ae81ff">0</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">1</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#ae81ff">0</span> <span style="color:#00a8c8">index</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#111">were</span> <span style="color:#111">removed</span><span style="color:#ae81ff">.</span>
<span style="color:#ae81ff">0</span> <span style="color:#00a8c8">index</span> <span style="color:#111">pages</span> <span style="color:#111">have</span> <span style="color:#111">been</span> <span style="color:#111">deleted</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">are</span> <span style="color:#111">currently</span> <span style="color:#111">reusable</span><span style="color:#ae81ff">.</span>
<span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#ae81ff">.</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#d88200">&#34;pg_toast_94097&#34;</span><span style="color:#111">:</span> <span style="color:#111">found</span> <span style="color:#ae81ff">0</span> <span style="color:#111">removable</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">nonremovable</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">0</span> <span style="color:#00a8c8">out</span> <span style="color:#00a8c8">of</span> <span style="color:#ae81ff">0</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#ae81ff">0</span> <span style="color:#111">dead</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#111">cannot</span> <span style="color:#111">be</span> <span style="color:#111">removed</span> <span style="color:#111">yet</span><span style="color:#111">,</span> <span style="color:#111">oldest</span> <span style="color:#111">xmin</span><span style="color:#111">:</span> <span style="color:#ae81ff">3745654</span>
<span style="color:#111">There</span> <span style="color:#111">were</span> <span style="color:#ae81ff">0</span> <span style="color:#111">unused</span> <span style="color:#111">item</span> <span style="color:#111">identifiers</span><span style="color:#ae81ff">.</span>
<span style="color:#111">Skipped</span> <span style="color:#ae81ff">0</span> <span style="color:#111">pages</span> <span style="color:#111">due</span> <span style="color:#00a8c8">to</span> <span style="color:#111">buffer</span> <span style="color:#111">pins</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">frozen</span> <span style="color:#111">pages</span><span style="color:#ae81ff">.</span>
<span style="color:#ae81ff">0</span> <span style="color:#111">pages</span> <span style="color:#111">are</span> <span style="color:#111">entirely</span> <span style="color:#111">empty</span><span style="color:#ae81ff">.</span>
<span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#ae81ff">.</span>
<span style="color:#00a8c8">VACUUM</span>
</code></pre></div><p>This took around 5 minutes, but of course this is a dev system that is totally idle, the rows aren&rsquo;t very large, there&rsquo;s minimal TOAST involved, and there&rsquo;s not really that many indexes. Vacuum times can get really out of hand when there&rsquo;s more going on.</p>
<p>Now we&rsquo;ll do the same thing, but with only 99 dead tuples:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-postgres" data-lang="postgres"><span style="color:#00a8c8">update</span> <span style="color:#111">vactest</span> <span style="color:#00a8c8">set</span> <span style="color:#111">t</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;bar&#39;</span> <span style="color:#00a8c8">where</span> <span style="color:#111">id</span><span style="color:#f92672">&lt;</span><span style="color:#ae81ff">100</span><span style="color:#111">;</span>
<span style="color:#00a8c8">UPDATE</span> <span style="color:#ae81ff">99</span>
<span style="color:#111">stratify</span><span style="color:#f92672">=#</span> <span style="color:#00a8c8">vacuum</span> <span style="color:#00a8c8">verbose</span> <span style="color:#111">vactest</span><span style="color:#111">;</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#111">vacuuming</span> <span style="color:#d88200">&#34;public.vactest&#34;</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#111">scanned</span> <span style="color:#00a8c8">index</span> <span style="color:#d88200">&#34;pk_vactest&#34;</span> <span style="color:#00a8c8">to</span> <span style="color:#111">remove</span> <span style="color:#ae81ff">85</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.90</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.20</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">14.49</span> <span style="color:#111">s</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#111">scanned</span> <span style="color:#00a8c8">index</span> <span style="color:#d88200">&#34;idx01_vactest&#34;</span> <span style="color:#00a8c8">to</span> <span style="color:#111">remove</span> <span style="color:#ae81ff">85</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.76</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.35</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">17.22</span> <span style="color:#111">s</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#d88200">&#34;vactest&#34;</span><span style="color:#111">:</span> <span style="color:#111">removed</span> <span style="color:#ae81ff">85</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">2</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#00a8c8">index</span> <span style="color:#d88200">&#34;pk_vactest&#34;</span> <span style="color:#111">now</span> <span style="color:#111">contains</span> <span style="color:#ae81ff">50000000</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">274193</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#ae81ff">85</span> <span style="color:#00a8c8">index</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#111">were</span> <span style="color:#111">removed</span><span style="color:#ae81ff">.</span>
<span style="color:#ae81ff">0</span> <span style="color:#00a8c8">index</span> <span style="color:#111">pages</span> <span style="color:#111">have</span> <span style="color:#111">been</span> <span style="color:#111">deleted</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">are</span> <span style="color:#111">currently</span> <span style="color:#111">reusable</span><span style="color:#ae81ff">.</span>
<span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#ae81ff">.</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#00a8c8">index</span> <span style="color:#d88200">&#34;idx01_vactest&#34;</span> <span style="color:#111">now</span> <span style="color:#111">contains</span> <span style="color:#ae81ff">50000000</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">163111</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#ae81ff">85</span> <span style="color:#00a8c8">index</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#111">were</span> <span style="color:#111">removed</span><span style="color:#ae81ff">.</span>
<span style="color:#ae81ff">0</span> <span style="color:#00a8c8">index</span> <span style="color:#111">pages</span> <span style="color:#111">have</span> <span style="color:#111">been</span> <span style="color:#111">deleted</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">are</span> <span style="color:#111">currently</span> <span style="color:#111">reusable</span><span style="color:#ae81ff">.</span>
<span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#ae81ff">.</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#d88200">&#34;vactest&#34;</span><span style="color:#111">:</span> <span style="color:#111">found</span> <span style="color:#ae81ff">99</span> <span style="color:#111">removable</span><span style="color:#111">,</span> <span style="color:#ae81ff">935</span> <span style="color:#111">nonremovable</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">5</span> <span style="color:#00a8c8">out</span> <span style="color:#00a8c8">of</span> <span style="color:#ae81ff">265487</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#ae81ff">0</span> <span style="color:#111">dead</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#111">cannot</span> <span style="color:#111">be</span> <span style="color:#111">removed</span> <span style="color:#111">yet</span><span style="color:#111">,</span> <span style="color:#111">oldest</span> <span style="color:#111">xmin</span><span style="color:#111">:</span> <span style="color:#ae81ff">3745655</span>
<span style="color:#111">There</span> <span style="color:#111">were</span> <span style="color:#ae81ff">34</span> <span style="color:#111">unused</span> <span style="color:#111">item</span> <span style="color:#111">identifiers</span><span style="color:#ae81ff">.</span>
<span style="color:#111">Skipped</span> <span style="color:#ae81ff">0</span> <span style="color:#111">pages</span> <span style="color:#111">due</span> <span style="color:#00a8c8">to</span> <span style="color:#111">buffer</span> <span style="color:#111">pins</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">frozen</span> <span style="color:#111">pages</span><span style="color:#ae81ff">.</span>
<span style="color:#ae81ff">0</span> <span style="color:#111">pages</span> <span style="color:#111">are</span> <span style="color:#111">entirely</span> <span style="color:#111">empty</span><span style="color:#ae81ff">.</span>
<span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">1.67</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.56</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">31.71</span> <span style="color:#111">s</span><span style="color:#ae81ff">.</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#111">vacuuming</span> <span style="color:#d88200">&#34;pg_toast.pg_toast_94097&#34;</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#00a8c8">index</span> <span style="color:#d88200">&#34;pg_toast_94097_index&#34;</span> <span style="color:#111">now</span> <span style="color:#111">contains</span> <span style="color:#ae81ff">0</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">1</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#ae81ff">0</span> <span style="color:#00a8c8">index</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#111">were</span> <span style="color:#111">removed</span><span style="color:#ae81ff">.</span>
<span style="color:#ae81ff">0</span> <span style="color:#00a8c8">index</span> <span style="color:#111">pages</span> <span style="color:#111">have</span> <span style="color:#111">been</span> <span style="color:#111">deleted</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">are</span> <span style="color:#111">currently</span> <span style="color:#111">reusable</span><span style="color:#ae81ff">.</span>
<span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#ae81ff">.</span>
<span style="color:#111">INFO</span><span style="color:#111">:</span>  <span style="color:#d88200">&#34;pg_toast_94097&#34;</span><span style="color:#111">:</span> <span style="color:#111">found</span> <span style="color:#ae81ff">0</span> <span style="color:#111">removable</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">nonremovable</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#00a8c8">in</span> <span style="color:#ae81ff">0</span> <span style="color:#00a8c8">out</span> <span style="color:#00a8c8">of</span> <span style="color:#ae81ff">0</span> <span style="color:#111">pages</span>
<span style="color:#111">DETAIL</span><span style="color:#111">:</span>  <span style="color:#ae81ff">0</span> <span style="color:#111">dead</span> <span style="color:#00a8c8">row</span> <span style="color:#111">versions</span> <span style="color:#111">cannot</span> <span style="color:#111">be</span> <span style="color:#111">removed</span> <span style="color:#111">yet</span><span style="color:#111">,</span> <span style="color:#111">oldest</span> <span style="color:#111">xmin</span><span style="color:#111">:</span> <span style="color:#ae81ff">3745655</span>
<span style="color:#111">There</span> <span style="color:#111">were</span> <span style="color:#ae81ff">0</span> <span style="color:#111">unused</span> <span style="color:#111">item</span> <span style="color:#111">identifiers</span><span style="color:#ae81ff">.</span>
<span style="color:#111">Skipped</span> <span style="color:#ae81ff">0</span> <span style="color:#111">pages</span> <span style="color:#111">due</span> <span style="color:#00a8c8">to</span> <span style="color:#111">buffer</span> <span style="color:#111">pins</span><span style="color:#111">,</span> <span style="color:#ae81ff">0</span> <span style="color:#111">frozen</span> <span style="color:#111">pages</span><span style="color:#ae81ff">.</span>
<span style="color:#ae81ff">0</span> <span style="color:#111">pages</span> <span style="color:#111">are</span> <span style="color:#111">entirely</span> <span style="color:#111">empty</span><span style="color:#ae81ff">.</span>
<span style="color:#111">CPU</span><span style="color:#111">:</span> <span style="color:#00a8c8">user</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#00a8c8">system</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#111">,</span> <span style="color:#111">elapsed</span><span style="color:#111">:</span> <span style="color:#ae81ff">0.00</span> <span style="color:#111">s</span><span style="color:#ae81ff">.</span>
<span style="color:#00a8c8">VACUUM</span>
</code></pre></div><p>This took about 30 seconds.</p>
<p>So really all of this is to illustrate why vacuuming more often (but not <em>too</em> often) is better than waiting for many dead tuples to stack up. And why the default percentage-based scale factor settings don&rsquo;t scale well to large tables. The more dead tuples there are in a table, the longer they take to clean up.</p>
<p>Of course, this is actually a bad example in a sense - if you update 20% of a table in a single transaction, all those dead tuples will be generated before autovacuum has a chance to clean it up. Setting a lower autovacuum threshold won&rsquo;t help you. Most OLTP usage patterns don&rsquo;t look like this however. And for things like bulk data updates you should absolutely consider making manual vacuuming part of the process and consider that part of the operation time.</p>
<p>Next post will be about how pgstratify can help you set more appropriate thresholds for your large tables.</p>

                    </div>
                    
                </section>
            </div>
            <div class="footer">
    <div class="pure-menu pure-menu-horizontal pure-menu-open">
        <ul>
            <li>Powered by <a class="hugo" href="https://gohugo.io/" target="_blank">hugo</a></li>
            <li>Copyright © 2020-2022 James Lucas</li>
            <li>ALL VIEWS AND OPINIONS ARE MY OWN.<br>THE AUTHOR WILL NOT BE LIABLE FOR DAMAGES OR LOSSES RESULTING FROM<br>USE OR IMPLEMENTATION OF INFORMATION OR TECHNIQUES PUBLISHED ON THIS SITE.</li>
        </ul>
    </div>
</div>
<script src='https://jlucasdba.github.io/js/all.min.js'></script>

        </div>
    </div>
</div>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', '', 'auto');
ga('send', 'pageview');

</script>

</body>
</html>
